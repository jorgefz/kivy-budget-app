#:import get_color_from_hex kivy.utils.get_color_from_hex
#:import KivyGraph kivy_garden.graph.Graph
#:import calendar calendar

MDScreen:

	MDRelativeLayout:

		MDBottomNavigation:
			id: rail

			MDBottomNavigationItem:
				icon: "home"
				text: 'Overview'
				on_tab_release: screen_manager.current = 'Home'

			MDBottomNavigationItem:
				icon: "chart-line"
				text: 'Graphs'
				on_tab_release: screen_manager.current = 'Graphs'
			
			MDBottomNavigationItem:
				icon: "database"
				text: 'Data'
				on_tab_release: screen_manager.current = 'Data'

		MDBoxLayout:
			orientation: 'vertical'
		
			# MDTopAppBar:
			# 	title: "Budget App"
			# 	pos_hint: {"top": 1}
			# 	size_hint_y: dp(0.06)
			
			ScreenManager:
				id: screen_manager
				HomeScreen:
				GraphScreen:
				DataTableScreen:

<HomeScreen>:
	name: "Home"
	datetime_label: datetime_label

	MDLabel:
		id: datetime_label
		text: root.date
		pos_hint: {"center_x": 0.55,"center_y": 0.92}
		theme_text_color: "Primary"
		font_style: "H2"
		font_size: 30
	
	MDRelativeLayout:
		pos_hint: {'center_x': 0.5, 'center_y': 0.75}
		MDLabel:
			text: "Balance"
			pos_hint: {"center_y": 0.57}
			halign:'center'
			theme_text_color: "Primary"
			font_style: "H3"
			font_size: 26
		MDLabel:
			text: app.balance_text
			pos_hint: {"center_y": 0.5}
			halign:'center'
			theme_text_color: "Primary"
			font_style: "H2"
			font_size: 45

	MDRelativeLayout:
		pos_hint: {'center_x': 0.25, 'center_y': 0.55}
		MDLabel:
			text: "Income"
			pos_hint: {"center_y": 0.57}
			halign:'center'
			theme_text_color: "Primary"
			font_style: "H3"
			font_size: 26
		MDLabel:
			text: app.income_text
			pos_hint: {"center_y": 0.5}
			halign:'center'
			theme_text_color: "Custom"
			text_color: "#00FF00"
			font_style: "H2"
			font_size: 38

	MDRelativeLayout:
		pos_hint: {'center_x': 0.75, 'center_y': 0.55}
		MDLabel:
			text: "Expenses"
			halign: "center"
			pos_hint: {"center_y": 0.57, "center_x": 0.5}
			theme_text_color: "Primary"
			font_style: "H3"
			font_size: 26
		MDLabel:
			text: app.expenses_text
			pos_hint: {"center_y": 0.5, "center_x": 0.5}
			halign: "center"
			theme_text_color: "Custom"
			text_color: "#FF0000"
			font_style: "H2"
			font_size: 38
	
	MDRelativeLayout:
		pos_hint: {'center_x': 0.25, 'center_y': 0.3}
		MDLabel:
			text: "Profit"
			pos_hint: {"center_y": 0.55}
			halign:'center'
			theme_text_color: "Primary"
			font_style: "H3"
			font_size: 26
		MDLabel:
			text: app.profit_text
			pos_hint: {"center_y": 0.48}
			halign:'center'
			theme_text_color: "Custom"
			text_color: "#FFA500"
			font_style: "H2"
			font_size: 38

	DonutPlot:
		id: profit_donut
		pos_hint: {'center_x': 0.75, 'center_y': 0.3}
		adaptive_size: True
		size_hint: 0.8,0.8
		on_parent:
			self.set_theme('dark')
			self.clear()
			pct = 100.0 * (1.0 - app.profit / app.income)
			self.plot(0.8, limits=[0,1], text=f"{int(pct)}%",fontsize=28, color="orange", textcolor="w")
			self.show()

<GraphScreen>:
	name: "Graphs"
	dataset: app.dataset
	each_day: app.each_day

	PlotWidget:
		id: balance_plot
		# size: (700,500)
		# size_hint: (None,None)
		pos_hint:  {'center_x': 0.55, 'center_y': 0.7}
		adaptive_size: True
		size_hint: (1.1,0.5)

	MDLabel:
		text: "Balance over time"
		pos_hint: {"center_y": 0.95}
		halign: "center"
		theme_text_color: "Primary"
		font_style: "H4"

	MDRaisedButton:
		id: month_selection
		size_hint: None, None
        width: dp(100) + (self.ids.lbl_txt.texture_size[0] - self.ids.lbl_txt.texture_size[0])
		pos_hint: {'center_y': 0.35, 'center_x': 0.3}
		text: "All Year"
		font_size: 18
		on_release: root.month_dropdown.open()

	MDRaisedButton:
		id: year_selection
		size_hint: None, None
        width: dp(100) + (self.ids.lbl_txt.texture_size[0] - self.ids.lbl_txt.texture_size[0])
		pos_hint: {'center_y': 0.35, 'center_x': 0.7}
		text: "2022"
		font_size: 18
		on_release: root.year_dropdown.open()
	

<DataTableScreen>:
	name: "Data"
	dataset: app.dataset
	columns: ["date", "amount", "balance"]

